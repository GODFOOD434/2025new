# 出库Excel导入处理流程

## 1. 导入流程

1. 用户从ERP系统导出出库相关Excel文件
2. 用户登录系统，进入"出库管理"页面
3. 上传Excel文件
4. 系统解析Excel文件，识别以下字段：
   - 物料凭证
   - 开单日期
   - 物料编码
   - 物资名称及规格型号
   - 计量单位
   - 实拨数量
   - 出库单价
   - 具体用料部门
   - 料单分属
   - 物资品种码
   - 工程编码
   - 应拨数量
   - 出库金额
   - 用料单位
   - 单据类型
   - 合计金额
   - 发料日期
   - 销售金额
   - 转储订单/销售订单
   - 管理费率
5. 系统验证数据有效性
6. 将数据保存到数据库
7. 返回导入结果

## 2. 导入时补充采购订单号

1. 在导入过程中，系统显示上传的出库数据
2. 保管员需要在导入前为每条记录补充对应的采购订单号
3. 系统提供采购订单号搜索功能，帮助保管员快速找到对应的采购订单
4. 系统自动验证采购订单号的有效性，并检查物料编码是否匹配
5. 保管员可以批量补充采购订单号，也可以选择不填写（如直接出库的情况）
6. 补充完成后，继续导入流程

## 3. 数据验证规则

- 物料凭证不能为空
- 物料编码不能为空
- 实拨数量必须大于0
- 具体用料部门不能为空
- 检查库存是否足够满足实拨数量
- 如果填写了采购订单号，需要验证该订单号是否存在且物料编码是否匹配

## 4. 错误处理

- 对于验证失败的记录，生成错误报告
- 允许用户下载错误报告
- 支持部分导入（有效记录导入，无效记录跳过）
- 对于库存不足的情况，标记为"待确认"状态，需要保管员特别确认
- 对于采购订单号不匹配的情况，提示保管员重新选择

## 5. 导入后处理

- 记录导入日志
- 自动更新库存数据
- 更新系统缓存

## 6. ERP出库Excel文件格式

### 6.1 ERP导出字段
| 物料凭证 | 开单日期 | 物料编码 | 物资名称及规格型号 | 计量单位 | 实拨数量 | 出库单价 | 具体用料部门 | 料单分属 | 物资品种码 | 工程编码 | 应拨数量 | 出库金额 | 用料单位 | 单据类型 | 合计金额 | 发料日期 | 销售金额 | 转储订单/销售订单 | 管理费率 |
|---------|---------|---------|-------------------|---------|---------|---------|------------|---------|---------|---------|---------|---------|---------|---------|---------|---------|---------|-----------------|--------|
| M202306001 | 2023-06-15 | 10001 | 钢板 Q235B 10mm | 吨 | 5 | 1000 | 生产部 | 生产线 | A001 | P2023001 | 5 | 5000 | 生产部 | 正常出库 | 5000 | 2023-06-16 | 0 | - | 3% |
| M202306002 | 2023-06-15 | 10002 | 螺丝 M8*30 | 盒 | 10 | 50 | 维修部 | 设备维护 | B002 | P2023002 | 10 | 500 | 维修部 | 正常出库 | 500 | 2023-06-16 | 0 | - | 3% |

### 6.2 系统补充字段
| 采购订单号 | 备注 |
|------------|------|
| PO20230501001 | 生产线维修用料 |
| PO20230502002 | 设备定期维护 |

## 7. 批量处理

- 支持批量导入多个出库记录
- 支持批量补充采购订单号
- 支持批量确认出库
- 支持批量打印出库单
- 提供批量操作的进度显示和结果统计

## 8. 系统集成

- 与ERP系统集成，支持自动获取出库数据
- 与采购订单管理模块集成，支持快速查询采购订单信息
- 与库存管理模块集成，支持实时查询库存状态
- 与消息通知模块集成，支持自动发送出库相关通知
